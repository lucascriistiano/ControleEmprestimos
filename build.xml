<!-- Copyright (C) 2016 Federal University of Pernambuco and 
     University of Central Florida
 
 * This file is part of AspectJML
 *
 * AJML is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2, or (at your option)
 * any later version.
 *
 * AJML is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with AJML; see the file COPYING.  If not, write to
 * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
 *
 * $Id: build.xml,v 4.0 2016/4/14 03:09:30 henriquerebelo Exp $ 
-->
<!-- THE FUN HAS JUST BEGUN!! AspectJML team -->
<project name="AspectJML tools release 1.8.0" default="ajmlc-e-testes-junit">

	<!-- THE ASPECTJML COMPILER (ajmlc) VERSION BEING USED  -->

	<property name="AspectJML"                 value="1.8.0" />


	<!-- SYSTEM DEPENDENT VARIABLES        -   CHANGE FOR YOUR NEEDS  -->
	<property name="aspectjml.release.jar"     value="aspectjml-lib/aspectjml-release1.8.0.jar" />
	<property name="src.dir"                   value="src/main/java" />
	<property name="test.dir"				   value="src/test/java" />
	<!-- From within Eclipse, you can put the generated bytecode directly at the "bin" folder and run the application direclty from Eclipse-->
	<!-- This tip is useful if you have several main classes and to avoid run one by one by changing the "main.class" property -->
	<property name="dest.dir"                  value="bin" />
	<!-- Target directory to print the instrumented source code (isc) as AspectJ aspects -->
	<property name="dest.dir.isc"              value="isc" />
	<property name="crossref.dir"              value="crossref" />
	<property name="main.class"                value="instanciahotel.MainHotel" />
	<property name="app.lib"                   value="lib" />
	<property name="aspectjml.lib"             value="aspectjml-lib" />
	<!-- NOTE: 'aspectjml.lib' MUST INCLUDE ASPECTJ WEAVERS, AJC AND ABC -->

	<!-- CLASSPATH OF AspectJML TOOL FOR COMPILATION AND CHECKING TASKS -->
	<taskdef classpath="${aspectjml.release.jar}" resource="org/jmlspecs/ant/taskdefs/aspectjmlTaskdefs.properties" />

	<!-- SOURCEPATH FOR EXTRA SOURCEROOTS FOR COMPILATION AND TASKS -->
	<path id="sourcepath">
		<!-- IF YOU HAVE MORE SOURCE FILES DIFFERENT FROM THOSE IN ${src.dir},
		     UNCOMMENT THE FOLLOWING AND SPECIFY THE EXTRA DIR(s). PLEASE USE 
		     ONE "dirset" FOR EACH EXTRA DIR -->
		<!--<dirset dir="dirName" />-->
	</path>

	<!-- CLASSPATH FOR COMPILATION AND TASKS -->
	<path id="classpath">
		<!-- IF YOU HAVE APPLICATION SPECIFIC LIB, UNCOMMENT THE FOLLOWING -->
		<!--<fileset dir="${app.lib}">
			<include name="*.jar" />
		</fileset>-->
		<fileset dir="${aspectjml.lib}">
			<include name="*.jar" />
		</fileset>
	</path>
	
	<!-- CLASSES NECESSÁRIAS PARA COMPILAR OS TESTES JUNITS -->
	<path id="classesjml">  
		<fileset dir="${app.lib}">
				<include name="*.jar" />
		</fileset>
		<fileset dir="${aspectjml.lib}">
			<include name="*.jar" />
		</fileset>
	    <fileset dir="${dest.dir}">
	        <include name="**/*.class"/>
	    </fileset>
	</path>

	<!-- INPATH TO ACCEPT AS SOURCE BYTECODE ANY .CLASS FILE IN THE .JAR FILES OR DIRECTORIES ON PATH -->
	<path id="inpath">
		<!-- IF YOU HAVE LIBS THAT SHOULD BE PROCESSED, UNCOMMENT THE FOLLOWING -->
		<!--<fileset dir="dirName">
			<include name="*.jar" />
		</fileset>-->
		<!-- OR YOU MAY ALSO HAVE DIRECTORIES CONTAINING .CLASS FILES, UNCOMMENT THE FOLLOWING -->
		<!--<dirset dir="dirName" />-->
	</path>

	<!-- CREATE NEEDED DIRECTORIES -->
	<target name="prepare">
		<mkdir dir="${dest.dir}" />
	</target>

	<!-- CLEANUP -->
	<target name="clean">
		<delete dir="${dest.dir}" />
	</target>

	<!-- CLEANUP CROSS REFERENCE INFORMATION ABOUT THE SPECIFIED CROSSCUTTING CONTRACTS-->
	<target name="clean-cross-ref" description="Ant task responsible for cleaning all the cross references of crosscutting contract specifications. This version is compatible with AspectJML using ajmlc compiler version ${AspectJML}">
		<delete>
			<fileset dir="${crossref.dir}" includes="**/*.aj" />
		</delete>
	</target>

	<!-- CLEANUP RESIDUAL GENERATED ASPECTS FOR CONTRACT CHECKING -->
	<!-- IF YOU FACE ANY COMPILATION PROBLEM AND ACCIDENTALLY SEE ANY GENERATED ASPECTJML ASPECT, 
		PLEASE USE THIS TASK TO REMOVE SUCH ASPECTS FROM THE SYSTEM -->
	<target name="clean-residual-aspectjml">
		<delete>
			<fileset dir="${src.dir}" includes="**/AspectJMLRac_*.aj" />
		</delete>
	</target>

	<!-- VERSION INFORMATION -->
	<target name="ajmlc-version-options" description="Task responsible for printing the ajmlc version">
		<java classname="org.jmlspecs.ajmlrac.Main" fork="true">
			<arg value="--version" />
			<classpath refid="classpath" />
		</java>
	</target>

	<!-- HELP OPTIONS -->
	<target name="ajmlc-help-options" description="Task responsible for displaying ajmlc compilation options">
		<java classname="org.jmlspecs.ajmlrac.Main" fork="true">
			<arg value="--help" />
			<classpath refid="classpath" />
		</java>
	</target>

	<!-- COMPILATIONS -->
	<!-- Note that these are the most common options used to run an AspectJML annotated Java program. 
		   - Also, these options include the advanced ones for AspectJML such as the crosscutting contract specifications 
		     with "crosscuttingcontractspecifications" option. 
		   - All these advanced ajmlc options are not enabled by default.
		   - For more ajmlc options, please run the task above "ajmlc-help-options" and update the "ajmlc task" below to properly include them-->
	<!-- THE FUN HAS JUST BEGUN!! AspectJML team -->
	<target name="ajmlc" depends="clean,prepare" description="Ant task responsible for compiling Java files annotated with AspectJML using ajmlc compiler version ${AspectJML}">
		<ajmlc destdir="${dest.dir}" srcdir="${src.dir}" sourcepathref="sourcepath" classpathref="classpath" inpath="inpath" print="false" source="1.8" ajweaver="ajc" 
			defaultnonnull="true" norepresentserror="false" noexecutionsiteinstrumenation="false" callsiteinstrumenation="false" clientawarechecking="false" 
		    multiplespeccasechecking="false" nocrosscutting="false" nocontractchecking="false" crossrefs="${crossref.dir}" 
		    showweaveinfo="false" quiet="false" verbose="false" fork="false">
		</ajmlc>
	</target>
	
	<path id="test.classpath">
		 <pathelement location="${dest.dir}" />
	</path>
	
	<target name="ajmlc-e-testes-junit"  depends="clean,prepare">
		
		<ajmlc destdir="${dest.dir}" srcdir="${src.dir}" sourcepathref="sourcepath" classpathref="classpath" inpath="inpath" print="false" source="1.8" ajweaver="ajc" 
			defaultnonnull="true" norepresentserror="false" noexecutionsiteinstrumenation="false" callsiteinstrumenation="false" clientawarechecking="false" 
		    multiplespeccasechecking="false" nocrosscutting="false" nocontractchecking="false" crossrefs="${crossref.dir}" 
		    showweaveinfo="false" quiet="false" verbose="false" fork="false">
		</ajmlc>
		<javac debug="true" classpathref="classesjml" srcdir="src/test/java" destdir="bin" includeantruntime="false"/>
		
		<junit printsummary="yes" fork="false" haltonfailure="no" showoutput="true">
			<classpath>
					<pathelement path="${dest.dir}"/> <!-- .class do projeto -->
			        <pathelement location="${app.lib}/junit-4.12.jar" />
					<pathelement location="${app.lib}/hamcrest-core-1.3.jar" />
					<pathelement location="${app.lib}/mockito-all-1.10.19.jar" />
		    </classpath>
			
			<classpath refid="classpath"/>
			
			<!-- Descomentar para detalhar testes -->
			<!-- <formatter type="plain" usefile="false" /> --> 
			<formatter usefile="false" type="brief"/>
			<batchtest skipNonTests="true" fork="false">
			    <fileset dir="${dest.dir}">
			    	 <include name="**/*Test.class" />
			    	 <exclude name="**/SuiteDeTestes.class"/>
			    </fileset>
			  </batchtest>
		</junit>
		
	</target>
	
	<target name="build-testes-junit">
		<javac debug="true" classpathref="classesjml" srcdir="src/test/java" destdir="bin" includeantruntime="false"/>
		<junit printsummary="yes" fork="false" haltonfailure="no" showoutput="true">
			<classpath>
					<pathelement path="${dest.dir}"/> <!-- .class do projeto -->
			        <pathelement location="${app.lib}/junit-4.12.jar" />
					<pathelement location="${app.lib}/hamcrest-core-1.3.jar"  />
					<pathelement location="${app.lib}/mockito-all-1.10.19.jar" />
		    </classpath>
			
			<classpath refid="classpath"/>
			
			<!-- Descomentar para detalhar testes -->
			<!-- <formatter type="plain" usefile="false" /> -->
			<formatter usefile="false" type="brief"/>
			<batchtest skipNonTests="true" fork="false">
			    <fileset dir="${dest.dir}">
			    	 <include name="**/*Test.class" />
			    	 <exclude name="**/SuiteDeTestes.class"/>
			    </fileset>
			  </batchtest>
		</junit>
	</target>

	<!-- TYPE CHECKING -->
	<target name="ajml"  description="Ant task responsible for type checking Java files annotated with AspectJML using ajml type checker version ${AspectJML}">
		<ajml destdir="${dest.dir}" srcdir="${src.dir}" sourcepathref="sourcepath" classpathref="classpath" verbose="false">
		</ajml>
	</target>
	

</project>
